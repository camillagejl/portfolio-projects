"use strict";let headline,headlineApple,bloodStain;document.addEventListener("DOMContentLoaded",getTimelineJson);let fatalityIndex,svgIndex=0;function isTouchDevice(){var e=" -webkit- -moz- -o- -ms- ".split(" ");return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||function(e){return window.matchMedia(e).matches}(["(",e.join("touch-enabled),("),"heartz",")"].join(""))}async function getTimelineJson(){let e=await fetch("https://mandalskeawebspace.dk/claude_php/clean_up_spreadsheet.php?id=1uLNO5Z7ghpMy283IND0YbnVHK-gW6VIGHrCk39T_DRo");fetchSVGs(await e.json())}function fetchSVGs(e){const t=fetch("elements/Headline_name.svg").then(e=>e.text()),n=fetch("elements/Apple_name.svg").then(e=>e.text()),o=fetch("elements/blood.svg").then(e=>e.text());Promise.all([t,n,o]).then((function(e){const[t,n,o]=e;headline=t,headlineApple=n,bloodStain=o})),e.forEach(t=>{const n=fetch(`elements/${t.firstname}_name.svg`).then(e=>e.text());Promise.all([n]).then((function(n){const[o]=n;t.namesvg=o,++svgIndex===e.length&&start(e)}))})}function start(e){isTouchDevice()&&document.body.classList.add("touch_body"),document.querySelectorAll(".close_infobox_div").forEach(e=>{e.addEventListener("click",hideInfobox)}),document.querySelector(".close_button").addEventListener("click",hideInfobox),document.querySelector(".headline").innerHTML=headline,document.querySelector(".apple").innerHTML=headlineApple,document.querySelector(".bloodstain_note").innerHTML=bloodStain,document.querySelector("#bloodstain").innerHTML=bloodStain;const t=document.querySelector(".music"),n=document.querySelector("#l_theme"),o=t.querySelector(".music_on_button"),i=t.querySelector(".music_off_button");let l=!1;t.addEventListener("click",(function(){l?(n.pause(),l=!1,o.style.display="none",i.style.display="block"):(n.play(),l=!0,o.style.display="block",i.style.display="none")})),showTimeline(e,0)}function showTimeline(e,t){const n=e[fatalityIndex=t];let o=calculateTimelineGap(e,fatalityIndex),i=renderDate(n.birth),l=renderDate(n.death);const c=document.querySelector(".timeline_template").content.cloneNode(!0);if(c.querySelector(".timeline_icon").src=`elements/${n.deathcategory}.svg`,c.querySelector(".timeline_name").innerHTML=n.namesvg,c.querySelector(".timeline_death_date").textContent=l||n.death,o>0){c.querySelector(".timeline_line").style.width="4px";let e=Math.round(o+10);c.querySelector(".timeline_line_container").style.height=`${e}px`}document.querySelector(".book_timeline").appendChild(c),document.querySelector(".book_timeline").lastElementChild.addEventListener("click",(function(){const e=document.querySelector(".infobox_template").content.cloneNode(!0);e.querySelector(".infobox_image_container").innerHTML=`<img class="infobox_image" src="elements/${n.firstname}.svg"  alt="Image of character">`,e.querySelector(".infobox_name").innerHTML=n.namesvg,e.querySelector(".infobox_birth_date").innerHTML+=i||n.birth||"Unknown",e.querySelector(".infobox_death_date").innerHTML+=l||n.death,e.querySelector(".infobox_story").innerHTML+=n.story,e.querySelector(".infobox_death_cause").innerHTML+=n.causeofdeath,document.querySelector(".book_infobox").innerHTML="",document.querySelector(".book_infobox").appendChild(e),document.body.classList.add("mobile_hide_overflow"),document.querySelector(".close_button").classList.add("mobile_show"),document.querySelector(".music").classList.add("mobile_hide"),document.body.classList.contains("touch_body")&&document.querySelectorAll(".close_infobox_div").forEach(e=>{e.style.display="block"})})),fatalityIndex++,e.length>fatalityIndex?showTimeline(e,fatalityIndex):observeTimeline()}function hideInfobox(){document.querySelectorAll(".close_infobox_div").forEach(e=>{e.style.display="none"}),document.querySelector(".infobox div").innerHTML="",document.querySelector(".infobox").style.display="none",document.body.classList.remove("mobile_hide_overflow"),document.querySelector(".close_button").classList.remove("mobile_show"),document.querySelector(".music").classList.remove("mobile_hide"),document.querySelector(".music").style.animation="none",document.querySelector(".music").style.opacity="1"}function observeTimeline(){const e=document.querySelectorAll(".observe_this");let t=new IntersectionObserver(e=>{e.forEach(e=>{e.intersectionRatio>.75&&e.target.classList.add("visible")})},{root:null,rootMargin:"0px",threshold:[0,.25,.75,1]});e.forEach(e=>{t.observe(e)})}function calculateTimelineGap(e,t){let n,o=e[t],i=e[t+1],l=new Date(o.death);if(i){let e=new Date(i.death);n=Math.round((e-l)/864e5)}return n>150&&n<1e3&&(n=Math.round(n/1.5)),n>1e3&&(n=Math.round(n/4)),n||0}function renderDate(e){let t=new Date(e);if("Invalid Date"!=t){let e=t.getFullYear(),n=leadingZero(t.getMonth()+1);return leadingZero(t.getDate())+"/"+n+"/"+e}}function leadingZero(e){return("0"+e).slice(-2)}
